{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"Welcome to MkDocs For full documentation visit mkdocs.org . Commands mkdocs new [dir-name] - Create a new project. mkdocs serve - Start the live-reloading docs server. mkdocs build - Build the documentation site. mkdocs -h - Print help message and exit. Project layout mkdocs.yml # The configuration file. docs/ index.md # The documentation homepage. ... # Other markdown pages, images and other files.","title":"Home"},{"location":"#welcome-to-mkdocs","text":"For full documentation visit mkdocs.org .","title":"Welcome to MkDocs"},{"location":"#commands","text":"mkdocs new [dir-name] - Create a new project. mkdocs serve - Start the live-reloading docs server. mkdocs build - Build the documentation site. mkdocs -h - Print help message and exit.","title":"Commands"},{"location":"#project-layout","text":"mkdocs.yml # The configuration file. docs/ index.md # The documentation homepage. ... # Other markdown pages, images and other files.","title":"Project layout"},{"location":"api/","text":"polymage agent agent Agent Bases: ABC Abstract base class for creating intelligent agents that interact with platforms. This class serves as a blueprint for implementing various types of agents (e.g., chatbots, code assistants, content generators) that can process prompts and generate responses using different AI models. Attributes: platform ( Platform ) \u2013 The platform instance this agent operates on model ( str ) \u2013 The AI model identifier (e.g., 'gpt-4', 'llama3') used for generating responses response_model ( Optional [ BaseModel ] ) \u2013 Pydantic model defining the structure of expected responses, or None if free-form text responses are acceptable system_prompt ( Optional [ str ] ) \u2013 System-level instructions that define the agent's behavior and role Example class ChatAgent(Agent): def run(self, prompt: str, media: Optional[List[Media]] = None, **kwargs) -> Any: # Implementation here pass Source code in src/polymage/agent/agent.py 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 class Agent ( ABC ): \"\"\" Abstract base class for creating intelligent agents that interact with platforms. This class serves as a blueprint for implementing various types of agents (e.g., chatbots, code assistants, content generators) that can process prompts and generate responses using different AI models. Attributes: platform (Platform): The platform instance this agent operates on model (str): The AI model identifier (e.g., 'gpt-4', 'llama3') used for generating responses response_model (Optional[BaseModel]): Pydantic model defining the structure of expected responses, or None if free-form text responses are acceptable system_prompt (Optional[str]): System-level instructions that define the agent's behavior and role Example: class ChatAgent(Agent): def run(self, prompt: str, media: Optional[List[Media]] = None, **kwargs) -> Any: # Implementation here pass \"\"\" def __init__ ( self , platform : Platform , model : str , response_model : Optional [ BaseModel ] = None , system_prompt : Optional [ str ] = None , ): self . platform = platform self . model = model self . response_model = response_model self . system_prompt = system_prompt @abstractmethod def run ( self , prompt : str , media : Optional [ List [ Media ]] = None , ** kwargs : Any ) -> Any : \"\"\" Execute the agent with a given prompt and optional media. This abstract method must be implemented by subclasses to define how the agent processes input and generates responses. Args: prompt (str): The user's input or instruction for the agent media (Optional[List[Media]]): List of media objects (images, files) to process, or None if no media is provided **kwargs: Additional keyword arguments for flexible input handling Returns: Any: The result of the agent's processing, typically a response or generated content Raises: NotImplementedError: If subclass doesn't implement this method \"\"\" pass run ( prompt , media = None , ** kwargs ) abstractmethod Execute the agent with a given prompt and optional media. This abstract method must be implemented by subclasses to define how the agent processes input and generates responses. Parameters: prompt ( str ) \u2013 The user's input or instruction for the agent media ( Optional [ List [ Media ]] , default: None ) \u2013 List of media objects (images, files) to process, or None if no media is provided **kwargs ( Any , default: {} ) \u2013 Additional keyword arguments for flexible input handling Returns: Any ( Any ) \u2013 The result of the agent's processing, typically a response or generated content Raises: NotImplementedError \u2013 If subclass doesn't implement this method Source code in src/polymage/agent/agent.py 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 @abstractmethod def run ( self , prompt : str , media : Optional [ List [ Media ]] = None , ** kwargs : Any ) -> Any : \"\"\" Execute the agent with a given prompt and optional media. This abstract method must be implemented by subclasses to define how the agent processes input and generates responses. Args: prompt (str): The user's input or instruction for the agent media (Optional[List[Media]]): List of media objects (images, files) to process, or None if no media is provided **kwargs: Additional keyword arguments for flexible input handling Returns: Any: The result of the agent's processing, typically a response or generated content Raises: NotImplementedError: If subclass doesn't implement this method \"\"\" pass image_captioner_agent ImageCaptionerAgent Bases: Agent Source code in src/polymage/agent/image_captioner_agent.py 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 class ImageCaptionerAgent ( Agent ): \"\"\" \"\"\" def __init__ ( self , ** kwargs ): super () . __init__ ( ** kwargs ) def run ( self , prompt : str , media : Optional [ List [ Media ]] = None , ** kwargs : Any ) -> Any : \"\"\" Execute the image captioning process. Args: prompt (str): The prompt or instruction for image description generation. media (Optional[List[Media]]): List of media objects to process. Defaults to None. **kwargs: Additional keyword arguments passed to the platform's image2text method. Returns: Any: The result from the platform's image-to-text conversion, typically a string or structured data containing the generated caption or description. \"\"\" platform = self . platform model = self . model system_prompt = self . system_prompt return platform . image2text ( model = model , prompt = prompt , media = media , ** kwargs ) run ( prompt , media = None , ** kwargs ) Execute the image captioning process. Parameters: prompt ( str ) \u2013 The prompt or instruction for image description generation. media ( Optional [ List [ Media ]] , default: None ) \u2013 List of media objects to process. Defaults to None. **kwargs ( Any , default: {} ) \u2013 Additional keyword arguments passed to the platform's image2text method. Returns: Any ( Any ) \u2013 The result from the platform's image-to-text conversion, typically a string or structured data containing the generated caption or description. Source code in src/polymage/agent/image_captioner_agent.py 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 def run ( self , prompt : str , media : Optional [ List [ Media ]] = None , ** kwargs : Any ) -> Any : \"\"\" Execute the image captioning process. Args: prompt (str): The prompt or instruction for image description generation. media (Optional[List[Media]]): List of media objects to process. Defaults to None. **kwargs: Additional keyword arguments passed to the platform's image2text method. Returns: Any: The result from the platform's image-to-text conversion, typically a string or structured data containing the generated caption or description. \"\"\" platform = self . platform model = self . model system_prompt = self . system_prompt return platform . image2text ( model = model , prompt = prompt , media = media , ** kwargs ) image_generator_agent ImageGeneratorAgent Bases: Agent An agent responsible for generating images. Source code in src/polymage/agent/image_generator_agent.py 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 class ImageGeneratorAgent ( Agent ): \"\"\" An agent responsible for generating images. \"\"\" def __init__ ( self , ** kwargs ): super () . __init__ ( ** kwargs ) def run ( self , prompt : str , media : Optional [ List [ Media ]] = None , response_model : Optional [ BaseModel ] = None , ** kwargs : Any ) -> Any : \"\"\" Execute the image captioning process. Args: prompt (str): The prompt or instruction for image description generation. media (Optional[List[Media]]): List of media objects to process. Defaults to None. **kwargs: Additional keyword arguments passed to the platform's image2text method. Returns: Any: The result from the platform's image-to-text conversion, typically a string or structured data containing the generated caption or description. \"\"\" platform = self . platform model = self . model system_prompt = self . system_prompt if media is None : return platform . text2image ( model = model , prompt = prompt , ** kwargs ) else : return platform . image2image ( model = model , prompt = prompt , media = media , ** kwargs ) run ( prompt , media = None , response_model = None , ** kwargs ) Execute the image captioning process. Parameters: prompt ( str ) \u2013 The prompt or instruction for image description generation. media ( Optional [ List [ Media ]] , default: None ) \u2013 List of media objects to process. Defaults to None. **kwargs ( Any , default: {} ) \u2013 Additional keyword arguments passed to the platform's image2text method. Returns: Any ( Any ) \u2013 The result from the platform's image-to-text conversion, typically a string or structured data containing the generated caption or description. Source code in src/polymage/agent/image_generator_agent.py 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 def run ( self , prompt : str , media : Optional [ List [ Media ]] = None , response_model : Optional [ BaseModel ] = None , ** kwargs : Any ) -> Any : \"\"\" Execute the image captioning process. Args: prompt (str): The prompt or instruction for image description generation. media (Optional[List[Media]]): List of media objects to process. Defaults to None. **kwargs: Additional keyword arguments passed to the platform's image2text method. Returns: Any: The result from the platform's image-to-text conversion, typically a string or structured data containing the generated caption or description. \"\"\" platform = self . platform model = self . model system_prompt = self . system_prompt if media is None : return platform . text2image ( model = model , prompt = prompt , ** kwargs ) else : return platform . image2image ( model = model , prompt = prompt , media = media , ** kwargs ) instruct_agent InstructAgent Bases: Agent Source code in src/polymage/agent/instruct_agent.py 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 class InstructAgent ( Agent ): \"\"\" \"\"\" def __init__ ( self , ** kwargs : Any ) -> None : super () . __init__ ( ** kwargs ) def run ( self , prompt : str , media : Optional [ List [ Media ]] = None , ** kwargs : Any ) -> Any : \"\"\" Execute a text-to-text transformation using the configured platform. This method processes a prompt through the platform's text2text capability, optionally incorporating a system prompt if one was provided during initialization. Args: prompt (str): The input text prompt to process media (Optional[List[Media]]): Optional list of media objects to include in the processing (e.g., images, files) **kwargs: Additional keyword arguments to pass to the platform's text2text method Returns: Any: The result from the platform's text2text processing, typically a string or structured data based on response_model parameter Note: If system_prompt was provided during initialization, it will be merged with any additional kwargs, where the system prompt takes precedence in case of key conflicts. \"\"\" if self . system_prompt is not None : kwargs [ 'system_prompt' ] = self . system_prompt return self . platform . text2text ( model = self . model , prompt = prompt , media = media , response_model = self . response_model , ** kwargs ) run ( prompt , media = None , ** kwargs ) Execute a text-to-text transformation using the configured platform. This method processes a prompt through the platform's text2text capability, optionally incorporating a system prompt if one was provided during initialization. Parameters: prompt ( str ) \u2013 The input text prompt to process media ( Optional [ List [ Media ]] , default: None ) \u2013 Optional list of media objects to include in the processing (e.g., images, files) **kwargs ( Any , default: {} ) \u2013 Additional keyword arguments to pass to the platform's text2text method Returns: Any ( Any ) \u2013 The result from the platform's text2text processing, typically a string or structured data based on response_model parameter Note If system_prompt was provided during initialization, it will be merged with any additional kwargs, where the system prompt takes precedence in case of key conflicts. Source code in src/polymage/agent/instruct_agent.py 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 def run ( self , prompt : str , media : Optional [ List [ Media ]] = None , ** kwargs : Any ) -> Any : \"\"\" Execute a text-to-text transformation using the configured platform. This method processes a prompt through the platform's text2text capability, optionally incorporating a system prompt if one was provided during initialization. Args: prompt (str): The input text prompt to process media (Optional[List[Media]]): Optional list of media objects to include in the processing (e.g., images, files) **kwargs: Additional keyword arguments to pass to the platform's text2text method Returns: Any: The result from the platform's text2text processing, typically a string or structured data based on response_model parameter Note: If system_prompt was provided during initialization, it will be merged with any additional kwargs, where the system prompt takes precedence in case of key conflicts. \"\"\" if self . system_prompt is not None : kwargs [ 'system_prompt' ] = self . system_prompt return self . platform . text2text ( model = self . model , prompt = prompt , media = media , response_model = self . response_model , ** kwargs ) media image_media ImageMedia Bases: Media Image media class using Pillow as internal representation. This class provides a wrapper around PIL (Pillow) Image objects to handle image media with additional functionality for base64 encoding and metadata management. Attributes: _image ( Image ) \u2013 Internal PIL Image object _metadata ( Optional [ dict ] ) \u2013 Metadata associated with the image Example from PIL import Image pil_img = Image.open('image.jpg') image_media = ImageMedia(pil_img, {'author': 'John Doe'}) Convert to base64 base64_data = image_media.to_base64() Save with metadata image_media.save_to_file('output.png') Source code in src/polymage/media/image_media.py 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 class ImageMedia ( Media ): \"\"\" Image media class using Pillow as internal representation. This class provides a wrapper around PIL (Pillow) Image objects to handle image media with additional functionality for base64 encoding and metadata management. Attributes: _image (PIL.Image.Image): Internal PIL Image object _metadata (Optional[dict]): Metadata associated with the image Example: from PIL import Image pil_img = Image.open('image.jpg') image_media = ImageMedia(pil_img, {'author': 'John Doe'}) # Convert to base64 base64_data = image_media.to_base64() # Save with metadata image_media.save_to_file('output.png') \"\"\" def __init__ ( self , image_data : Union [ str , bytes , Image . Image ], metadata : Optional [ Dict [ str , Any ]] = None , ** kwargs : Any ) -> None : self . _metadata = metadata # Auto-detect based on type if isinstance ( image_data , str ): self . _image = base64_to_image ( image_data ) elif isinstance ( image_data , bytes ): self . _image = bytes_to_image ( image_data ) elif isinstance ( image_data , Image . Image ): self . _image = image_data else : raise TypeError ( \"image_data must be either a Pillow Image or base64-encoded string or raw bytes.\" ) def to_base64 ( self , format = 'PNG' ) -> str : \"\"\" Convert the image to a base64 encoded string. Args: format (str): Image format for encoding (default: 'PNG') Returns: str: Base64 encoded string representation of the image Example: base64_str = image_media.to_base64('JPEG') \"\"\" # Create an in-memory bytes buffer buffer = BytesIO () # Save the image to the buffer in the specified format self . _image . save ( buffer , format = format ) # Get the bytes from the buffer image_bytes = buffer . getvalue () # Encode the bytes as base64 and decode to a string base64_str = base64 . b64encode ( image_bytes ) . decode ( 'utf-8' ) return base64_str def save_to_file ( self , filepath : str ) -> None : \"\"\" Save the image to a file with metadata support. Args: filepath (str): Path where the image should be saved Example: image_media.save_to_file('output.png') \"\"\" metadata = self . _metadata self . _image . load () # Ensures image is fully loaded file_metameta = PngInfo () if metadata is not None : for key , value in metadata . items (): file_metameta . add_text ( key , value ) # save to file self . _image . save ( filepath , pnginfo = file_metameta ) save_to_file ( filepath ) Save the image to a file with metadata support. Parameters: filepath ( str ) \u2013 Path where the image should be saved Example image_media.save_to_file('output.png') Source code in src/polymage/media/image_media.py 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 def save_to_file ( self , filepath : str ) -> None : \"\"\" Save the image to a file with metadata support. Args: filepath (str): Path where the image should be saved Example: image_media.save_to_file('output.png') \"\"\" metadata = self . _metadata self . _image . load () # Ensures image is fully loaded file_metameta = PngInfo () if metadata is not None : for key , value in metadata . items (): file_metameta . add_text ( key , value ) # save to file self . _image . save ( filepath , pnginfo = file_metameta ) to_base64 ( format = 'PNG' ) Convert the image to a base64 encoded string. Parameters: format ( str , default: 'PNG' ) \u2013 Image format for encoding (default: 'PNG') Returns: str ( str ) \u2013 Base64 encoded string representation of the image Example base64_str = image_media.to_base64('JPEG') Source code in src/polymage/media/image_media.py 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 def to_base64 ( self , format = 'PNG' ) -> str : \"\"\" Convert the image to a base64 encoded string. Args: format (str): Image format for encoding (default: 'PNG') Returns: str: Base64 encoded string representation of the image Example: base64_str = image_media.to_base64('JPEG') \"\"\" # Create an in-memory bytes buffer buffer = BytesIO () # Save the image to the buffer in the specified format self . _image . save ( buffer , format = format ) # Get the bytes from the buffer image_bytes = buffer . getvalue () # Encode the bytes as base64 and decode to a string base64_str = base64 . b64encode ( image_bytes ) . decode ( 'utf-8' ) return base64_str media Media Bases: ABC Abstract base class representing a multimedia object. Provides multiple constructors and conversion methods. Source code in src/polymage/media/media.py 6 7 8 9 10 class Media ( ABC ): \"\"\" Abstract base class representing a multimedia object. Provides multiple constructors and conversion methods. \"\"\" model platform cloudflare CloudflarePlatform Bases: Platform Source code in src/polymage/platform/cloudflare.py 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 class CloudflarePlatform ( Platform ): def __init__ ( self , api_id : str , api_key : str , ** kwargs : Any ) -> None : super () . __init__ ( 'lmstudio' , list (( flux_1_schnell , dreamshaper_8_lcm , lucid_origin )), ** kwargs ) self . _api_id = api_id self . _api_key = api_key def _text2image ( self , model : Model , prompt : str , ** kwargs : Any ) -> ImageMedia : CLOUDFLARE_ID = self . _api_id CLOUDFLARE_TOKEN = self . _api_key payload = model . model_default_params () # add the prompt to the params payload [ \"prompt\" ] = prompt url = \"https://api.cloudflare.com/client/v4/accounts/\" + CLOUDFLARE_ID + \"/ai/run/\" + model . model_internal_name () headers = { 'Content-Type' : 'application/json' , 'Authorization' : 'Bearer ' + CLOUDFLARE_TOKEN } data = payload try : response = requests . post ( url , headers = headers , json = data ) response . raise_for_status () # Raise an exception for HTTP errors if model . model_output_type () == \"bytes\" : # image is returned as binary image_data = response . content return ImageMedia ( image_data ,{ 'Software' : f \" { self . platform_name () } / { model . model_name () } \" , 'Description' : prompt }) else : # image is returned as base64 result = response . json () image_data = result [ 'result' ][ 'image' ] return ImageMedia ( image_data ,{ 'Software' : f \" { self . platform_name () } / { model . model_name () } \" , 'Description' : prompt }) except Exception as e : logging . error ( \"API call failed\" , exc_info = True ) raise def _image2image ( self , model : str , prompt : str , image : Image . Image , ** kwargs : Any ) -> ImageMedia : pass def _text2text ( self , model : str , prompt : str , ** kwargs : Any ) -> Any : \"\"\"Not supported\"\"\" pass def _text2data ( self , model : str , response_model : BaseModel , prompt : str , ** kwargs : Any ) -> Any : \"\"\"Not supported\"\"\" pass def _image2text ( self , model : str , prompt : str , image : Image . Image , ** kwargs : Any ) -> str : \"\"\"Not supported\"\"\" pass def _image2data ( self , model : str , response_model : BaseModel , prompt : str , image : Image . Image , ** kwargs : Any ) -> Any : \"\"\"Not supported\"\"\" pass drawthings DrawThingsPlatform Bases: Platform Source code in src/polymage/platform/drawthings.py 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 class DrawThingsPlatform ( Platform ): def __init__ ( self , host : str = \"127.0.0.1:7860\" , ** kwargs : Any ) -> None : super () . __init__ ( 'lmstudio' , list (( hidream_fast , qwen_image_edit_8_steps , zimage_turbo )), ** kwargs ) self . host = host def _text2image ( self , model : Model , prompt : str , ** kwargs : Any ) -> ImageMedia : payload = model . model_default_params () payload [ \"prompt\" ] = prompt try : response = requests . post ( f \"http:// { self . host } /sdapi/v1/txt2img\" , json = payload ) response . raise_for_status () json_data = response . json () base64_string = json_data [ \"images\" ][ 0 ] return ImageMedia ( base64_string , { 'Software' : f \" { self . platform_name () } / { model . model_name () } \" , 'Description' : prompt }) except Exception as e : logging . error ( \"API call failed\" , exc_info = True ) raise def _image2image ( self , model : Model , prompt : str , media : ImageMedia , ** kwargs : Any ) -> ImageMedia : payload = model . model_default_params () payload [ \"prompt\" ] = prompt # for image2image it's better to fit the to the nearest aspect ratio media . _image = fit_to_nearest_aspect_ratio ( media . _image ) # and we need to pass the image size width , height = media . _image . size payload [ \"width\" ] = width payload [ \"height\" ] = height # convert the image to base64 base64_image = media . to_base64 () payload [ \"init_images\" ] = [ base64_image ] try : response = requests . post ( f \"http:// { self . host } /sdapi/v1/img2img\" , json = payload ) response . raise_for_status () json_data = response . json () base64_string = json_data [ \"images\" ][ 0 ] return ImageMedia ( base64_string , { 'Software' : f \" { self . platform_name () } / { model . model_name () } \" }) except Exception as e : logging . error ( \"API call failed\" , exc_info = True ) raise def _text2text ( self , model : Model , prompt : str , ** kwargs : Any ) -> Any : \"\"\"Not supported\"\"\" pass def _text2data ( self , model : Model , response_model : BaseModel , prompt : str , ** kwargs : Any ) -> Any : \"\"\"Not supported\"\"\" pass def _image2text ( self , model : Model , prompt : str , image : Image . Image , ** kwargs : Any ) -> str : \"\"\"Not supported\"\"\" pass def _image2data ( self , model : Model , response_model : BaseModel , prompt : str , image : Image . Image , ** kwargs : Any ) -> Any : \"\"\"Not supported\"\"\" pass groq GroqPlatform Bases: Platform Source code in src/polymage/platform/groq.py 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 class GroqPlatform ( Platform ): def __init__ ( self , api_key : str , ** kwargs : Any ) -> None : super () . __init__ ( 'groq' , list (( gpt_oss_20b , gpt_oss_120b , Qwen3_32b , llama_4_scout_17b_16e_instruct )), ** kwargs ) self . _api_key = api_key def _text2text ( self , model : Model , prompt : str , media : Optional [ List [ Media ]] = None , response_model : Optional [ BaseModel ] = None , ** kwargs : Any ) -> str : system_prompt : Optional [ str ] = kwargs . get ( \"system_prompt\" , \"You are a helpful assistant.\" ) client = Groq ( api_key = self . _api_key ) chat_completion = client . chat . completions . create ( model = model . platform_name (), messages = [ { \"role\" : \"system\" , \"content\" : system_prompt }, { \"role\" : \"user\" , \"content\" : prompt }, ], ) return chat_completion . choices [ 0 ] . message . content . strip () # # using structured data may sometime fail, because the result is not a valid JSON # if the JSON is not valid, retry 3 times # @retry ( retry = retry_if_exception_type ( json . JSONDecodeError ), stop = stop_after_attempt ( 3 ), wait = wait_random_exponential ( multiplier = 3 )) def _text2data ( self , model : Model , prompt : str , response_model : BaseModel , media : Optional [ List [ Media ]] = None , ** kwargs : Any ) -> str : system_prompt : Optional [ str ] = kwargs . get ( \"system_prompt\" , \"You are a helpful assistant.\" ) client = Groq ( api_key = self . _api_key ) json_schema = response_model . model_json_schema () json_schema_name = json_schema [ 'title' ] try : chat_completion = client . chat . completions . create ( model = model . model_internal_name (), messages = [ { \"role\" : \"system\" , \"content\" : system_prompt }, { \"role\" : \"user\" , \"content\" : prompt } ], response_format = { \"type\" : \"json_schema\" , \"json_schema\" : { \"name\" : json_schema_name , \"schema\" : json_schema , }, }, temperature = 0.8 , ) except : logging . error ( \"API call failed\" , exc_info = True ) raise json_string = chat_completion . choices [ 0 ] . message . content . strip () # return a python Dict return json . loads ( json_string ) def _image2text ( self , model : Model , prompt : str , media : List [ ImageMedia ], ** kwargs : Any ) -> str : client = Groq ( api_key = self . _api_key ) if len ( media ) == 0 : return \"\" else : image = media [ 0 ] base64_image = image . to_base64 () try : chat_completion = client . chat . completions . create ( model = model . model_internal_name (), messages = [ { \"role\" : \"user\" , \"content\" : [ { \"type\" : \"text\" , \"text\" : prompt }, { \"type\" : \"image_url\" , \"image_url\" : { \"url\" : f \"data:image/jpeg;base64, { base64_image } \" , }, }, ], } ], temperature = 1 , max_completion_tokens = 1024 , top_p = 1 , stream = False , stop = None , ) except Exception as e : logging . error ( \"API call failed\" , exc_info = True ) raise return chat_completion . choices [ 0 ] . message . content . strip () def _text2image ( self , model : Model , prompt : str , ** kwargs : Any ) -> Image . Image : \"\"\"Not supported\"\"\" pass def _image2image ( self , model : Model , prompt : str , image : Image . Image , ** kwargs : Any ) -> Image . Image : \"\"\"Not supported\"\"\" pass huggingface HuggingFacePlatform Bases: Platform Source code in src/polymage/platform/huggingface.py 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 class HuggingFacePlatform ( Platform ): def __init__ ( self , api_key : str , ** kwargs : Any ) -> None : super () . __init__ ( 'groq' , list (( SmolLM3_3b , flux_1_schnell , stable_diffusion_3_medium )), ** kwargs ) self . _api_key = api_key def _text2text ( self , model : Model , prompt : str , media : Optional [ List [ Media ]] = None , response_model : Optional [ BaseModel ] = None , ** kwargs : Any ) -> str : system_prompt : Optional [ str ] = kwargs . get ( \"system_prompt\" , \"You are a helpful assistant.\" ) client = InferenceClient ( api_key = self . _api_key ) try : chat_completion = client . chat . completions . create ( model = model . model_internal_name (), messages = [ { \"role\" : \"system\" , \"content\" : system_prompt }, { \"role\" : \"user\" , \"content\" : prompt }, ], ) except : logging . error ( \"API call failed\" , exc_info = True ) raise return chat_completion . choices [ 0 ] . message . content . strip () # # using structured data may sometime fail, because the result is not a valid JSON # if the JSON is not valid, retry 3 times # @retry ( retry = retry_if_exception_type ( json . JSONDecodeError ), stop = stop_after_attempt ( 3 ), wait = wait_random_exponential ( multiplier = 3 )) def _text2data ( self , model : Model , prompt : str , response_model : BaseModel , media : Optional [ List [ Media ]] = None , ** kwargs : Any ) -> str : system_prompt : Optional [ str ] = kwargs . get ( \"system_prompt\" , \"You are a helpful assistant.\" ) client = InferenceClient ( api_key = self . _api_key ) json_schema = response_model . model_json_schema () json_schema_name = json_schema [ 'title' ] try : chat_completion = client . chat . completions . create ( model = model . model_internal_name (), messages = [ { \"role\" : \"system\" , \"content\" : system_prompt }, { \"role\" : \"user\" , \"content\" : prompt } ], response_format = { \"type\" : \"json_schema\" , \"json_schema\" : { \"name\" : json_schema_name , \"schema\" : json_schema , }, }, temperature = 0.8 , ) except : logging . error ( \"API call failed\" , exc_info = True ) raise json_string = chat_completion . choices [ 0 ] . message . content . strip () # return a python Dict return json . loads ( json_string ) def _image2text ( self , model : Model , prompt : str , media : List [ ImageMedia ], ** kwargs : Any ) -> str : \"\"\"Not supported\"\"\" pass def _text2image ( self , model : Model , prompt : str , ** kwargs : Any ) -> Image . Image : client = InferenceClient ( provider = \"hf-inference\" , api_key = self . _api_key ) # output is a PIL.Image object try : image = client . text_to_image ( prompt , model = model . model_internal_name (), ) except : logging . error ( \"API call failed\" , exc_info = True ) raise return ImageMedia ( image , { 'Software' : f \" { self . platform_name () } / { model . model_name () } \" }) def _image2image ( self , model : Model , prompt : str , image : Image . Image , ** kwargs : Any ) -> Image . Image : \"\"\"Not supported\"\"\" pass lmstudio LMStudioPlatform Bases: Platform Source code in src/polymage/platform/lmstudio.py 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 class LMStudioPlatform ( Platform ): def __init__ ( self , host : str = \"127.0.0.1:1234\" , ** kwargs : Any ) -> None : super () . __init__ ( 'lmstudio' , list (( gemma_3_27b , qwen3_vl_30b )), ** kwargs ) self . _host = host self . _api_key = \"lm-studio\" # Dummy key (LM Studio doesn't require real keys) def _text2text ( self , model : Model , prompt : str , media : Optional [ List [ Media ]] = None , response_model : Optional [ BaseModel ] = None , ** kwargs : Any ) -> str : system_prompt : Optional [ str ] = kwargs . get ( \"system_prompt\" , \"\" ) client = OpenAI ( base_url = f \"http:// { self . _host } /v1\" , # LM Studio's default endpoint api_key = self . _api_key ) response = client . chat . completions . create ( model = model . model_internal_name (), messages = [ { \"role\" : \"system\" , \"content\" : system_prompt }, { \"role\" : \"user\" , \"content\" : prompt } ], temperature = 0.8 ) return response . choices [ 0 ] . message . content . strip () # # using structured data may sometime fail, because the result is not a valid JSON # if the JSON is not valid, retry 3 times # @retry ( retry = retry_if_exception_type ( json . JSONDecodeError ), stop = stop_after_attempt ( 3 )) def _text2data ( self , model : Model , prompt : str , response_model : BaseModel , media : Optional [ List [ Media ]] = None , ** kwargs : Any ) -> str : system_prompt : Optional [ str ] = kwargs . get ( \"system_prompt\" , \"\" ) client = OpenAI ( base_url = f \"http:// { self . _host } /v1\" , # LM Studio's default endpoint api_key = self . _api_key ) json_schema = response_model . model_json_schema () json_schema_name = json_schema [ 'title' ] chat_completion = client . chat . completions . create ( model = model . model_internal_name (), messages = [ { \"role\" : \"system\" , \"content\" : system_prompt }, { \"role\" : \"user\" , \"content\" : prompt } ], response_format = { \"type\" : \"json_schema\" , \"json_schema\" : { \"name\" : json_schema_name , \"schema\" : json_schema , }, }, temperature = 0.8 , ) json_string = chat_completion . choices [ 0 ] . message . content . strip () # return a python Dict return json . loads ( json_string ) def _image2text ( self , model : Model , prompt : str , media : List [ ImageMedia ], ** kwargs : Any ) -> str : client = OpenAI ( base_url = \"http://localhost:1234/v1\" , # LM Studio's default endpoint api_key = \"lm-studio\" # Dummy key (LM Studio doesn't require real keys) ) if len ( media ) == 0 : return \"\" else : image = media [ 0 ] base64_image = image . to_base64 () response = client . responses . create ( model = model . model_internal_name (), input = [ { \"role\" : \"user\" , \"content\" : [ { \"type\" : \"input_text\" , \"text\" : prompt }, { \"type\" : \"input_image\" , \"image_url\" : f \"data:image/png;base64, { base64_image } \" }, ], } ], ) return response . output [ 0 ] . content [ 0 ] . text def _text2image ( self , model : str , prompt : str , ** kwargs : Any ) -> Image . Image : \"\"\"Not supported\"\"\" pass def _image2image ( self , model : str , prompt : str , image : Image . Image , ** kwargs : Any ) -> Image . Image : \"\"\"Not supported\"\"\" pass platform Platform Bases: ABC Source code in src/polymage/platform/platform.py 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 class Platform ( ABC ): def __init__ ( self , name : str , models : List [ Model ], ** kwargs : Any ) -> None : self . _name = name self . _models = models def platform_name ( self ) -> str : return self . _name def platform_models ( self ) -> List [ Model ]: return self . _models def getModelByName ( self , name : str ) -> Model : for m in self . platform_models (): if m . model_name () == name : return m raise ValueError ( f \"Model { name } not found\" ) def text2text ( self , model : str , prompt : str , media : Optional [ List [ Media ]] = None , response_model : Optional [ str ] = None , ** kwargs : Any ) -> Any : \"\"\" Convert text to text with optional structured output. Args: model: The model identifier to use prompt: The input text prompt media: Optional list of media objects response_model: Optional Pydantic model for structured output **kwargs: Additional platform-specific arguments Returns: Any: Text response or structured data \"\"\" # get the model object for this platform platform_model = self . getModelByName ( model ) if response_model is None : return self . _text2text ( platform_model , prompt , media = media , response_model = response_model , ** kwargs ) # structured data output else : return self . _text2data ( platform_model , prompt , media = media , response_model = response_model , ** kwargs ) @abstractmethod def _text2text ( self , model : Model , prompt : str , media : Optional [ List [ Media ]] = None , response_model : Optional [ BaseModel ] = None , ** kwargs : Any ) -> Any : \"\"\"Platform-specific execution interface for text-to-text conversion\"\"\" pass @abstractmethod def _text2data ( self , model : Model , prompt : str , response_model : str , media : Optional [ List [ Media ]] = None , ** kwargs : Any ) -> Dict [ str , Any ]: \"\"\"Platform-specific execution interface for text-to-structured data conversion\"\"\" pass def text2image ( self , model : str , prompt : str , ** kwargs : Any ) -> ImageMedia : \"\"\" Convert text to image. Args: model: The model identifier to use prompt: The input text prompt **kwargs: Additional platform-specific arguments Returns: ImageMedia: Generated image media object \"\"\" platform_model = self . getModelByName ( model ) return self . _text2image ( platform_model , prompt , ** kwargs ) @abstractmethod def _text2image ( self , model : Model , prompt : str , ** kwargs : Any ) -> ImageMedia : \"\"\"Platform-specific execution interface for text-to-image conversion\"\"\" pass def image2text ( self , model : str , prompt : str , media : List [ ImageMedia ], ** kwargs : Any ) -> str : \"\"\" Convert image to text. Args: model: The model identifier to use prompt: The input text prompt guiding the image analysis media: List of ImageMedia objects to process **kwargs: Additional platform-specific arguments Returns: str: Text description or caption of the image(s) Raises: ValueError: If media list is empty \"\"\" platform_model = self . getModelByName ( model ) if not media : raise ValueError ( \"Media list cannot be empty\" ) return self . _image2text ( platform_model , prompt , media = media , ** kwargs ) @abstractmethod def _image2text ( self , model : Model , prompt : str , media : List [ ImageMedia ], ** kwargs : Any ) -> str : \"\"\"Platform-specific execution interface for image-to-text conversion\"\"\" pass def image2image ( self , model : str , prompt : str , media : List [ ImageMedia ], ** kwargs : Any ) -> ImageMedia : \"\"\" Convert image to image (image editing/transformations). Args: model: The model identifier to use prompt: The input text prompt guiding the transformation media: List of ImageMedia objects to process **kwargs: Additional platform-specific arguments Returns: ImageMedia: Transformed image media object \"\"\" platform_model = self . getModelByName ( model ) if media is not None : image = media [ 0 ] return self . _image2image ( platform_model , prompt , media = image , ** kwargs ) @abstractmethod def _image2image ( self , model : Model , prompt : str , media : ImageMedia , ** kwargs : Any ) -> ImageMedia : \"\"\"Platform-specific execution interface for image-to-image conversion\"\"\" pass image2image ( model , prompt , media , ** kwargs ) Convert image to image (image editing/transformations). Parameters: model ( str ) \u2013 The model identifier to use prompt ( str ) \u2013 The input text prompt guiding the transformation media ( List [ ImageMedia ] ) \u2013 List of ImageMedia objects to process **kwargs ( Any , default: {} ) \u2013 Additional platform-specific arguments Returns: ImageMedia ( ImageMedia ) \u2013 Transformed image media object Source code in src/polymage/platform/platform.py 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 def image2image ( self , model : str , prompt : str , media : List [ ImageMedia ], ** kwargs : Any ) -> ImageMedia : \"\"\" Convert image to image (image editing/transformations). Args: model: The model identifier to use prompt: The input text prompt guiding the transformation media: List of ImageMedia objects to process **kwargs: Additional platform-specific arguments Returns: ImageMedia: Transformed image media object \"\"\" platform_model = self . getModelByName ( model ) if media is not None : image = media [ 0 ] return self . _image2image ( platform_model , prompt , media = image , ** kwargs ) image2text ( model , prompt , media , ** kwargs ) Convert image to text. Parameters: model ( str ) \u2013 The model identifier to use prompt ( str ) \u2013 The input text prompt guiding the image analysis media ( List [ ImageMedia ] ) \u2013 List of ImageMedia objects to process **kwargs ( Any , default: {} ) \u2013 Additional platform-specific arguments Returns: str ( str ) \u2013 Text description or caption of the image(s) Raises: ValueError \u2013 If media list is empty Source code in src/polymage/platform/platform.py 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 def image2text ( self , model : str , prompt : str , media : List [ ImageMedia ], ** kwargs : Any ) -> str : \"\"\" Convert image to text. Args: model: The model identifier to use prompt: The input text prompt guiding the image analysis media: List of ImageMedia objects to process **kwargs: Additional platform-specific arguments Returns: str: Text description or caption of the image(s) Raises: ValueError: If media list is empty \"\"\" platform_model = self . getModelByName ( model ) if not media : raise ValueError ( \"Media list cannot be empty\" ) return self . _image2text ( platform_model , prompt , media = media , ** kwargs ) text2image ( model , prompt , ** kwargs ) Convert text to image. Parameters: model ( str ) \u2013 The model identifier to use prompt ( str ) \u2013 The input text prompt **kwargs ( Any , default: {} ) \u2013 Additional platform-specific arguments Returns: ImageMedia ( ImageMedia ) \u2013 Generated image media object Source code in src/polymage/platform/platform.py 69 70 71 72 73 74 75 76 77 78 79 80 81 82 def text2image ( self , model : str , prompt : str , ** kwargs : Any ) -> ImageMedia : \"\"\" Convert text to image. Args: model: The model identifier to use prompt: The input text prompt **kwargs: Additional platform-specific arguments Returns: ImageMedia: Generated image media object \"\"\" platform_model = self . getModelByName ( model ) return self . _text2image ( platform_model , prompt , ** kwargs ) text2text ( model , prompt , media = None , response_model = None , ** kwargs ) Convert text to text with optional structured output. Parameters: model ( str ) \u2013 The model identifier to use prompt ( str ) \u2013 The input text prompt media ( Optional [ List [ Media ]] , default: None ) \u2013 Optional list of media objects response_model ( Optional [ str ] , default: None ) \u2013 Optional Pydantic model for structured output **kwargs ( Any , default: {} ) \u2013 Additional platform-specific arguments Returns: Any ( Any ) \u2013 Text response or structured data Source code in src/polymage/platform/platform.py 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 def text2text ( self , model : str , prompt : str , media : Optional [ List [ Media ]] = None , response_model : Optional [ str ] = None , ** kwargs : Any ) -> Any : \"\"\" Convert text to text with optional structured output. Args: model: The model identifier to use prompt: The input text prompt media: Optional list of media objects response_model: Optional Pydantic model for structured output **kwargs: Additional platform-specific arguments Returns: Any: Text response or structured data \"\"\" # get the model object for this platform platform_model = self . getModelByName ( model ) if response_model is None : return self . _text2text ( platform_model , prompt , media = media , response_model = response_model , ** kwargs ) # structured data output else : return self . _text2data ( platform_model , prompt , media = media , response_model = response_model , ** kwargs )","title":"polymage"},{"location":"api/#polymage","text":"","title":"polymage"},{"location":"api/#polymage.agent","text":"","title":"agent"},{"location":"api/#polymage.agent.agent","text":"","title":"agent"},{"location":"api/#polymage.agent.agent.Agent","text":"Bases: ABC Abstract base class for creating intelligent agents that interact with platforms. This class serves as a blueprint for implementing various types of agents (e.g., chatbots, code assistants, content generators) that can process prompts and generate responses using different AI models. Attributes: platform ( Platform ) \u2013 The platform instance this agent operates on model ( str ) \u2013 The AI model identifier (e.g., 'gpt-4', 'llama3') used for generating responses response_model ( Optional [ BaseModel ] ) \u2013 Pydantic model defining the structure of expected responses, or None if free-form text responses are acceptable system_prompt ( Optional [ str ] ) \u2013 System-level instructions that define the agent's behavior and role Example class ChatAgent(Agent): def run(self, prompt: str, media: Optional[List[Media]] = None, **kwargs) -> Any: # Implementation here pass Source code in src/polymage/agent/agent.py 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 class Agent ( ABC ): \"\"\" Abstract base class for creating intelligent agents that interact with platforms. This class serves as a blueprint for implementing various types of agents (e.g., chatbots, code assistants, content generators) that can process prompts and generate responses using different AI models. Attributes: platform (Platform): The platform instance this agent operates on model (str): The AI model identifier (e.g., 'gpt-4', 'llama3') used for generating responses response_model (Optional[BaseModel]): Pydantic model defining the structure of expected responses, or None if free-form text responses are acceptable system_prompt (Optional[str]): System-level instructions that define the agent's behavior and role Example: class ChatAgent(Agent): def run(self, prompt: str, media: Optional[List[Media]] = None, **kwargs) -> Any: # Implementation here pass \"\"\" def __init__ ( self , platform : Platform , model : str , response_model : Optional [ BaseModel ] = None , system_prompt : Optional [ str ] = None , ): self . platform = platform self . model = model self . response_model = response_model self . system_prompt = system_prompt @abstractmethod def run ( self , prompt : str , media : Optional [ List [ Media ]] = None , ** kwargs : Any ) -> Any : \"\"\" Execute the agent with a given prompt and optional media. This abstract method must be implemented by subclasses to define how the agent processes input and generates responses. Args: prompt (str): The user's input or instruction for the agent media (Optional[List[Media]]): List of media objects (images, files) to process, or None if no media is provided **kwargs: Additional keyword arguments for flexible input handling Returns: Any: The result of the agent's processing, typically a response or generated content Raises: NotImplementedError: If subclass doesn't implement this method \"\"\" pass run ( prompt , media = None , ** kwargs ) abstractmethod Execute the agent with a given prompt and optional media. This abstract method must be implemented by subclasses to define how the agent processes input and generates responses. Parameters: prompt ( str ) \u2013 The user's input or instruction for the agent media ( Optional [ List [ Media ]] , default: None ) \u2013 List of media objects (images, files) to process, or None if no media is provided **kwargs ( Any , default: {} ) \u2013 Additional keyword arguments for flexible input handling Returns: Any ( Any ) \u2013 The result of the agent's processing, typically a response or generated content Raises: NotImplementedError \u2013 If subclass doesn't implement this method Source code in src/polymage/agent/agent.py 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 @abstractmethod def run ( self , prompt : str , media : Optional [ List [ Media ]] = None , ** kwargs : Any ) -> Any : \"\"\" Execute the agent with a given prompt and optional media. This abstract method must be implemented by subclasses to define how the agent processes input and generates responses. Args: prompt (str): The user's input or instruction for the agent media (Optional[List[Media]]): List of media objects (images, files) to process, or None if no media is provided **kwargs: Additional keyword arguments for flexible input handling Returns: Any: The result of the agent's processing, typically a response or generated content Raises: NotImplementedError: If subclass doesn't implement this method \"\"\" pass","title":"Agent"},{"location":"api/#polymage.agent.image_captioner_agent","text":"","title":"image_captioner_agent"},{"location":"api/#polymage.agent.image_captioner_agent.ImageCaptionerAgent","text":"Bases: Agent Source code in src/polymage/agent/image_captioner_agent.py 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 class ImageCaptionerAgent ( Agent ): \"\"\" \"\"\" def __init__ ( self , ** kwargs ): super () . __init__ ( ** kwargs ) def run ( self , prompt : str , media : Optional [ List [ Media ]] = None , ** kwargs : Any ) -> Any : \"\"\" Execute the image captioning process. Args: prompt (str): The prompt or instruction for image description generation. media (Optional[List[Media]]): List of media objects to process. Defaults to None. **kwargs: Additional keyword arguments passed to the platform's image2text method. Returns: Any: The result from the platform's image-to-text conversion, typically a string or structured data containing the generated caption or description. \"\"\" platform = self . platform model = self . model system_prompt = self . system_prompt return platform . image2text ( model = model , prompt = prompt , media = media , ** kwargs ) run ( prompt , media = None , ** kwargs ) Execute the image captioning process. Parameters: prompt ( str ) \u2013 The prompt or instruction for image description generation. media ( Optional [ List [ Media ]] , default: None ) \u2013 List of media objects to process. Defaults to None. **kwargs ( Any , default: {} ) \u2013 Additional keyword arguments passed to the platform's image2text method. Returns: Any ( Any ) \u2013 The result from the platform's image-to-text conversion, typically a string or structured data containing the generated caption or description. Source code in src/polymage/agent/image_captioner_agent.py 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 def run ( self , prompt : str , media : Optional [ List [ Media ]] = None , ** kwargs : Any ) -> Any : \"\"\" Execute the image captioning process. Args: prompt (str): The prompt or instruction for image description generation. media (Optional[List[Media]]): List of media objects to process. Defaults to None. **kwargs: Additional keyword arguments passed to the platform's image2text method. Returns: Any: The result from the platform's image-to-text conversion, typically a string or structured data containing the generated caption or description. \"\"\" platform = self . platform model = self . model system_prompt = self . system_prompt return platform . image2text ( model = model , prompt = prompt , media = media , ** kwargs )","title":"ImageCaptionerAgent"},{"location":"api/#polymage.agent.image_generator_agent","text":"","title":"image_generator_agent"},{"location":"api/#polymage.agent.image_generator_agent.ImageGeneratorAgent","text":"Bases: Agent An agent responsible for generating images. Source code in src/polymage/agent/image_generator_agent.py 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 class ImageGeneratorAgent ( Agent ): \"\"\" An agent responsible for generating images. \"\"\" def __init__ ( self , ** kwargs ): super () . __init__ ( ** kwargs ) def run ( self , prompt : str , media : Optional [ List [ Media ]] = None , response_model : Optional [ BaseModel ] = None , ** kwargs : Any ) -> Any : \"\"\" Execute the image captioning process. Args: prompt (str): The prompt or instruction for image description generation. media (Optional[List[Media]]): List of media objects to process. Defaults to None. **kwargs: Additional keyword arguments passed to the platform's image2text method. Returns: Any: The result from the platform's image-to-text conversion, typically a string or structured data containing the generated caption or description. \"\"\" platform = self . platform model = self . model system_prompt = self . system_prompt if media is None : return platform . text2image ( model = model , prompt = prompt , ** kwargs ) else : return platform . image2image ( model = model , prompt = prompt , media = media , ** kwargs ) run ( prompt , media = None , response_model = None , ** kwargs ) Execute the image captioning process. Parameters: prompt ( str ) \u2013 The prompt or instruction for image description generation. media ( Optional [ List [ Media ]] , default: None ) \u2013 List of media objects to process. Defaults to None. **kwargs ( Any , default: {} ) \u2013 Additional keyword arguments passed to the platform's image2text method. Returns: Any ( Any ) \u2013 The result from the platform's image-to-text conversion, typically a string or structured data containing the generated caption or description. Source code in src/polymage/agent/image_generator_agent.py 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 def run ( self , prompt : str , media : Optional [ List [ Media ]] = None , response_model : Optional [ BaseModel ] = None , ** kwargs : Any ) -> Any : \"\"\" Execute the image captioning process. Args: prompt (str): The prompt or instruction for image description generation. media (Optional[List[Media]]): List of media objects to process. Defaults to None. **kwargs: Additional keyword arguments passed to the platform's image2text method. Returns: Any: The result from the platform's image-to-text conversion, typically a string or structured data containing the generated caption or description. \"\"\" platform = self . platform model = self . model system_prompt = self . system_prompt if media is None : return platform . text2image ( model = model , prompt = prompt , ** kwargs ) else : return platform . image2image ( model = model , prompt = prompt , media = media , ** kwargs )","title":"ImageGeneratorAgent"},{"location":"api/#polymage.agent.instruct_agent","text":"","title":"instruct_agent"},{"location":"api/#polymage.agent.instruct_agent.InstructAgent","text":"Bases: Agent Source code in src/polymage/agent/instruct_agent.py 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 class InstructAgent ( Agent ): \"\"\" \"\"\" def __init__ ( self , ** kwargs : Any ) -> None : super () . __init__ ( ** kwargs ) def run ( self , prompt : str , media : Optional [ List [ Media ]] = None , ** kwargs : Any ) -> Any : \"\"\" Execute a text-to-text transformation using the configured platform. This method processes a prompt through the platform's text2text capability, optionally incorporating a system prompt if one was provided during initialization. Args: prompt (str): The input text prompt to process media (Optional[List[Media]]): Optional list of media objects to include in the processing (e.g., images, files) **kwargs: Additional keyword arguments to pass to the platform's text2text method Returns: Any: The result from the platform's text2text processing, typically a string or structured data based on response_model parameter Note: If system_prompt was provided during initialization, it will be merged with any additional kwargs, where the system prompt takes precedence in case of key conflicts. \"\"\" if self . system_prompt is not None : kwargs [ 'system_prompt' ] = self . system_prompt return self . platform . text2text ( model = self . model , prompt = prompt , media = media , response_model = self . response_model , ** kwargs ) run ( prompt , media = None , ** kwargs ) Execute a text-to-text transformation using the configured platform. This method processes a prompt through the platform's text2text capability, optionally incorporating a system prompt if one was provided during initialization. Parameters: prompt ( str ) \u2013 The input text prompt to process media ( Optional [ List [ Media ]] , default: None ) \u2013 Optional list of media objects to include in the processing (e.g., images, files) **kwargs ( Any , default: {} ) \u2013 Additional keyword arguments to pass to the platform's text2text method Returns: Any ( Any ) \u2013 The result from the platform's text2text processing, typically a string or structured data based on response_model parameter Note If system_prompt was provided during initialization, it will be merged with any additional kwargs, where the system prompt takes precedence in case of key conflicts. Source code in src/polymage/agent/instruct_agent.py 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 def run ( self , prompt : str , media : Optional [ List [ Media ]] = None , ** kwargs : Any ) -> Any : \"\"\" Execute a text-to-text transformation using the configured platform. This method processes a prompt through the platform's text2text capability, optionally incorporating a system prompt if one was provided during initialization. Args: prompt (str): The input text prompt to process media (Optional[List[Media]]): Optional list of media objects to include in the processing (e.g., images, files) **kwargs: Additional keyword arguments to pass to the platform's text2text method Returns: Any: The result from the platform's text2text processing, typically a string or structured data based on response_model parameter Note: If system_prompt was provided during initialization, it will be merged with any additional kwargs, where the system prompt takes precedence in case of key conflicts. \"\"\" if self . system_prompt is not None : kwargs [ 'system_prompt' ] = self . system_prompt return self . platform . text2text ( model = self . model , prompt = prompt , media = media , response_model = self . response_model , ** kwargs )","title":"InstructAgent"},{"location":"api/#polymage.media","text":"","title":"media"},{"location":"api/#polymage.media.image_media","text":"","title":"image_media"},{"location":"api/#polymage.media.image_media.ImageMedia","text":"Bases: Media Image media class using Pillow as internal representation. This class provides a wrapper around PIL (Pillow) Image objects to handle image media with additional functionality for base64 encoding and metadata management. Attributes: _image ( Image ) \u2013 Internal PIL Image object _metadata ( Optional [ dict ] ) \u2013 Metadata associated with the image Example from PIL import Image pil_img = Image.open('image.jpg') image_media = ImageMedia(pil_img, {'author': 'John Doe'})","title":"ImageMedia"},{"location":"api/#polymage.media.image_media.ImageMedia--convert-to-base64","text":"base64_data = image_media.to_base64()","title":"Convert to base64"},{"location":"api/#polymage.media.image_media.ImageMedia--save-with-metadata","text":"image_media.save_to_file('output.png') Source code in src/polymage/media/image_media.py 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 class ImageMedia ( Media ): \"\"\" Image media class using Pillow as internal representation. This class provides a wrapper around PIL (Pillow) Image objects to handle image media with additional functionality for base64 encoding and metadata management. Attributes: _image (PIL.Image.Image): Internal PIL Image object _metadata (Optional[dict]): Metadata associated with the image Example: from PIL import Image pil_img = Image.open('image.jpg') image_media = ImageMedia(pil_img, {'author': 'John Doe'}) # Convert to base64 base64_data = image_media.to_base64() # Save with metadata image_media.save_to_file('output.png') \"\"\" def __init__ ( self , image_data : Union [ str , bytes , Image . Image ], metadata : Optional [ Dict [ str , Any ]] = None , ** kwargs : Any ) -> None : self . _metadata = metadata # Auto-detect based on type if isinstance ( image_data , str ): self . _image = base64_to_image ( image_data ) elif isinstance ( image_data , bytes ): self . _image = bytes_to_image ( image_data ) elif isinstance ( image_data , Image . Image ): self . _image = image_data else : raise TypeError ( \"image_data must be either a Pillow Image or base64-encoded string or raw bytes.\" ) def to_base64 ( self , format = 'PNG' ) -> str : \"\"\" Convert the image to a base64 encoded string. Args: format (str): Image format for encoding (default: 'PNG') Returns: str: Base64 encoded string representation of the image Example: base64_str = image_media.to_base64('JPEG') \"\"\" # Create an in-memory bytes buffer buffer = BytesIO () # Save the image to the buffer in the specified format self . _image . save ( buffer , format = format ) # Get the bytes from the buffer image_bytes = buffer . getvalue () # Encode the bytes as base64 and decode to a string base64_str = base64 . b64encode ( image_bytes ) . decode ( 'utf-8' ) return base64_str def save_to_file ( self , filepath : str ) -> None : \"\"\" Save the image to a file with metadata support. Args: filepath (str): Path where the image should be saved Example: image_media.save_to_file('output.png') \"\"\" metadata = self . _metadata self . _image . load () # Ensures image is fully loaded file_metameta = PngInfo () if metadata is not None : for key , value in metadata . items (): file_metameta . add_text ( key , value ) # save to file self . _image . save ( filepath , pnginfo = file_metameta ) save_to_file ( filepath ) Save the image to a file with metadata support. Parameters: filepath ( str ) \u2013 Path where the image should be saved Example image_media.save_to_file('output.png') Source code in src/polymage/media/image_media.py 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 def save_to_file ( self , filepath : str ) -> None : \"\"\" Save the image to a file with metadata support. Args: filepath (str): Path where the image should be saved Example: image_media.save_to_file('output.png') \"\"\" metadata = self . _metadata self . _image . load () # Ensures image is fully loaded file_metameta = PngInfo () if metadata is not None : for key , value in metadata . items (): file_metameta . add_text ( key , value ) # save to file self . _image . save ( filepath , pnginfo = file_metameta ) to_base64 ( format = 'PNG' ) Convert the image to a base64 encoded string. Parameters: format ( str , default: 'PNG' ) \u2013 Image format for encoding (default: 'PNG') Returns: str ( str ) \u2013 Base64 encoded string representation of the image Example base64_str = image_media.to_base64('JPEG') Source code in src/polymage/media/image_media.py 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 def to_base64 ( self , format = 'PNG' ) -> str : \"\"\" Convert the image to a base64 encoded string. Args: format (str): Image format for encoding (default: 'PNG') Returns: str: Base64 encoded string representation of the image Example: base64_str = image_media.to_base64('JPEG') \"\"\" # Create an in-memory bytes buffer buffer = BytesIO () # Save the image to the buffer in the specified format self . _image . save ( buffer , format = format ) # Get the bytes from the buffer image_bytes = buffer . getvalue () # Encode the bytes as base64 and decode to a string base64_str = base64 . b64encode ( image_bytes ) . decode ( 'utf-8' ) return base64_str","title":"Save with metadata"},{"location":"api/#polymage.media.media","text":"","title":"media"},{"location":"api/#polymage.media.media.Media","text":"Bases: ABC Abstract base class representing a multimedia object. Provides multiple constructors and conversion methods. Source code in src/polymage/media/media.py 6 7 8 9 10 class Media ( ABC ): \"\"\" Abstract base class representing a multimedia object. Provides multiple constructors and conversion methods. \"\"\"","title":"Media"},{"location":"api/#polymage.model","text":"","title":"model"},{"location":"api/#polymage.platform","text":"","title":"platform"},{"location":"api/#polymage.platform.cloudflare","text":"","title":"cloudflare"},{"location":"api/#polymage.platform.cloudflare.CloudflarePlatform","text":"Bases: Platform Source code in src/polymage/platform/cloudflare.py 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 class CloudflarePlatform ( Platform ): def __init__ ( self , api_id : str , api_key : str , ** kwargs : Any ) -> None : super () . __init__ ( 'lmstudio' , list (( flux_1_schnell , dreamshaper_8_lcm , lucid_origin )), ** kwargs ) self . _api_id = api_id self . _api_key = api_key def _text2image ( self , model : Model , prompt : str , ** kwargs : Any ) -> ImageMedia : CLOUDFLARE_ID = self . _api_id CLOUDFLARE_TOKEN = self . _api_key payload = model . model_default_params () # add the prompt to the params payload [ \"prompt\" ] = prompt url = \"https://api.cloudflare.com/client/v4/accounts/\" + CLOUDFLARE_ID + \"/ai/run/\" + model . model_internal_name () headers = { 'Content-Type' : 'application/json' , 'Authorization' : 'Bearer ' + CLOUDFLARE_TOKEN } data = payload try : response = requests . post ( url , headers = headers , json = data ) response . raise_for_status () # Raise an exception for HTTP errors if model . model_output_type () == \"bytes\" : # image is returned as binary image_data = response . content return ImageMedia ( image_data ,{ 'Software' : f \" { self . platform_name () } / { model . model_name () } \" , 'Description' : prompt }) else : # image is returned as base64 result = response . json () image_data = result [ 'result' ][ 'image' ] return ImageMedia ( image_data ,{ 'Software' : f \" { self . platform_name () } / { model . model_name () } \" , 'Description' : prompt }) except Exception as e : logging . error ( \"API call failed\" , exc_info = True ) raise def _image2image ( self , model : str , prompt : str , image : Image . Image , ** kwargs : Any ) -> ImageMedia : pass def _text2text ( self , model : str , prompt : str , ** kwargs : Any ) -> Any : \"\"\"Not supported\"\"\" pass def _text2data ( self , model : str , response_model : BaseModel , prompt : str , ** kwargs : Any ) -> Any : \"\"\"Not supported\"\"\" pass def _image2text ( self , model : str , prompt : str , image : Image . Image , ** kwargs : Any ) -> str : \"\"\"Not supported\"\"\" pass def _image2data ( self , model : str , response_model : BaseModel , prompt : str , image : Image . Image , ** kwargs : Any ) -> Any : \"\"\"Not supported\"\"\" pass","title":"CloudflarePlatform"},{"location":"api/#polymage.platform.drawthings","text":"","title":"drawthings"},{"location":"api/#polymage.platform.drawthings.DrawThingsPlatform","text":"Bases: Platform Source code in src/polymage/platform/drawthings.py 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 class DrawThingsPlatform ( Platform ): def __init__ ( self , host : str = \"127.0.0.1:7860\" , ** kwargs : Any ) -> None : super () . __init__ ( 'lmstudio' , list (( hidream_fast , qwen_image_edit_8_steps , zimage_turbo )), ** kwargs ) self . host = host def _text2image ( self , model : Model , prompt : str , ** kwargs : Any ) -> ImageMedia : payload = model . model_default_params () payload [ \"prompt\" ] = prompt try : response = requests . post ( f \"http:// { self . host } /sdapi/v1/txt2img\" , json = payload ) response . raise_for_status () json_data = response . json () base64_string = json_data [ \"images\" ][ 0 ] return ImageMedia ( base64_string , { 'Software' : f \" { self . platform_name () } / { model . model_name () } \" , 'Description' : prompt }) except Exception as e : logging . error ( \"API call failed\" , exc_info = True ) raise def _image2image ( self , model : Model , prompt : str , media : ImageMedia , ** kwargs : Any ) -> ImageMedia : payload = model . model_default_params () payload [ \"prompt\" ] = prompt # for image2image it's better to fit the to the nearest aspect ratio media . _image = fit_to_nearest_aspect_ratio ( media . _image ) # and we need to pass the image size width , height = media . _image . size payload [ \"width\" ] = width payload [ \"height\" ] = height # convert the image to base64 base64_image = media . to_base64 () payload [ \"init_images\" ] = [ base64_image ] try : response = requests . post ( f \"http:// { self . host } /sdapi/v1/img2img\" , json = payload ) response . raise_for_status () json_data = response . json () base64_string = json_data [ \"images\" ][ 0 ] return ImageMedia ( base64_string , { 'Software' : f \" { self . platform_name () } / { model . model_name () } \" }) except Exception as e : logging . error ( \"API call failed\" , exc_info = True ) raise def _text2text ( self , model : Model , prompt : str , ** kwargs : Any ) -> Any : \"\"\"Not supported\"\"\" pass def _text2data ( self , model : Model , response_model : BaseModel , prompt : str , ** kwargs : Any ) -> Any : \"\"\"Not supported\"\"\" pass def _image2text ( self , model : Model , prompt : str , image : Image . Image , ** kwargs : Any ) -> str : \"\"\"Not supported\"\"\" pass def _image2data ( self , model : Model , response_model : BaseModel , prompt : str , image : Image . Image , ** kwargs : Any ) -> Any : \"\"\"Not supported\"\"\" pass","title":"DrawThingsPlatform"},{"location":"api/#polymage.platform.groq","text":"","title":"groq"},{"location":"api/#polymage.platform.groq.GroqPlatform","text":"Bases: Platform Source code in src/polymage/platform/groq.py 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 class GroqPlatform ( Platform ): def __init__ ( self , api_key : str , ** kwargs : Any ) -> None : super () . __init__ ( 'groq' , list (( gpt_oss_20b , gpt_oss_120b , Qwen3_32b , llama_4_scout_17b_16e_instruct )), ** kwargs ) self . _api_key = api_key def _text2text ( self , model : Model , prompt : str , media : Optional [ List [ Media ]] = None , response_model : Optional [ BaseModel ] = None , ** kwargs : Any ) -> str : system_prompt : Optional [ str ] = kwargs . get ( \"system_prompt\" , \"You are a helpful assistant.\" ) client = Groq ( api_key = self . _api_key ) chat_completion = client . chat . completions . create ( model = model . platform_name (), messages = [ { \"role\" : \"system\" , \"content\" : system_prompt }, { \"role\" : \"user\" , \"content\" : prompt }, ], ) return chat_completion . choices [ 0 ] . message . content . strip () # # using structured data may sometime fail, because the result is not a valid JSON # if the JSON is not valid, retry 3 times # @retry ( retry = retry_if_exception_type ( json . JSONDecodeError ), stop = stop_after_attempt ( 3 ), wait = wait_random_exponential ( multiplier = 3 )) def _text2data ( self , model : Model , prompt : str , response_model : BaseModel , media : Optional [ List [ Media ]] = None , ** kwargs : Any ) -> str : system_prompt : Optional [ str ] = kwargs . get ( \"system_prompt\" , \"You are a helpful assistant.\" ) client = Groq ( api_key = self . _api_key ) json_schema = response_model . model_json_schema () json_schema_name = json_schema [ 'title' ] try : chat_completion = client . chat . completions . create ( model = model . model_internal_name (), messages = [ { \"role\" : \"system\" , \"content\" : system_prompt }, { \"role\" : \"user\" , \"content\" : prompt } ], response_format = { \"type\" : \"json_schema\" , \"json_schema\" : { \"name\" : json_schema_name , \"schema\" : json_schema , }, }, temperature = 0.8 , ) except : logging . error ( \"API call failed\" , exc_info = True ) raise json_string = chat_completion . choices [ 0 ] . message . content . strip () # return a python Dict return json . loads ( json_string ) def _image2text ( self , model : Model , prompt : str , media : List [ ImageMedia ], ** kwargs : Any ) -> str : client = Groq ( api_key = self . _api_key ) if len ( media ) == 0 : return \"\" else : image = media [ 0 ] base64_image = image . to_base64 () try : chat_completion = client . chat . completions . create ( model = model . model_internal_name (), messages = [ { \"role\" : \"user\" , \"content\" : [ { \"type\" : \"text\" , \"text\" : prompt }, { \"type\" : \"image_url\" , \"image_url\" : { \"url\" : f \"data:image/jpeg;base64, { base64_image } \" , }, }, ], } ], temperature = 1 , max_completion_tokens = 1024 , top_p = 1 , stream = False , stop = None , ) except Exception as e : logging . error ( \"API call failed\" , exc_info = True ) raise return chat_completion . choices [ 0 ] . message . content . strip () def _text2image ( self , model : Model , prompt : str , ** kwargs : Any ) -> Image . Image : \"\"\"Not supported\"\"\" pass def _image2image ( self , model : Model , prompt : str , image : Image . Image , ** kwargs : Any ) -> Image . Image : \"\"\"Not supported\"\"\" pass","title":"GroqPlatform"},{"location":"api/#polymage.platform.huggingface","text":"","title":"huggingface"},{"location":"api/#polymage.platform.huggingface.HuggingFacePlatform","text":"Bases: Platform Source code in src/polymage/platform/huggingface.py 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 class HuggingFacePlatform ( Platform ): def __init__ ( self , api_key : str , ** kwargs : Any ) -> None : super () . __init__ ( 'groq' , list (( SmolLM3_3b , flux_1_schnell , stable_diffusion_3_medium )), ** kwargs ) self . _api_key = api_key def _text2text ( self , model : Model , prompt : str , media : Optional [ List [ Media ]] = None , response_model : Optional [ BaseModel ] = None , ** kwargs : Any ) -> str : system_prompt : Optional [ str ] = kwargs . get ( \"system_prompt\" , \"You are a helpful assistant.\" ) client = InferenceClient ( api_key = self . _api_key ) try : chat_completion = client . chat . completions . create ( model = model . model_internal_name (), messages = [ { \"role\" : \"system\" , \"content\" : system_prompt }, { \"role\" : \"user\" , \"content\" : prompt }, ], ) except : logging . error ( \"API call failed\" , exc_info = True ) raise return chat_completion . choices [ 0 ] . message . content . strip () # # using structured data may sometime fail, because the result is not a valid JSON # if the JSON is not valid, retry 3 times # @retry ( retry = retry_if_exception_type ( json . JSONDecodeError ), stop = stop_after_attempt ( 3 ), wait = wait_random_exponential ( multiplier = 3 )) def _text2data ( self , model : Model , prompt : str , response_model : BaseModel , media : Optional [ List [ Media ]] = None , ** kwargs : Any ) -> str : system_prompt : Optional [ str ] = kwargs . get ( \"system_prompt\" , \"You are a helpful assistant.\" ) client = InferenceClient ( api_key = self . _api_key ) json_schema = response_model . model_json_schema () json_schema_name = json_schema [ 'title' ] try : chat_completion = client . chat . completions . create ( model = model . model_internal_name (), messages = [ { \"role\" : \"system\" , \"content\" : system_prompt }, { \"role\" : \"user\" , \"content\" : prompt } ], response_format = { \"type\" : \"json_schema\" , \"json_schema\" : { \"name\" : json_schema_name , \"schema\" : json_schema , }, }, temperature = 0.8 , ) except : logging . error ( \"API call failed\" , exc_info = True ) raise json_string = chat_completion . choices [ 0 ] . message . content . strip () # return a python Dict return json . loads ( json_string ) def _image2text ( self , model : Model , prompt : str , media : List [ ImageMedia ], ** kwargs : Any ) -> str : \"\"\"Not supported\"\"\" pass def _text2image ( self , model : Model , prompt : str , ** kwargs : Any ) -> Image . Image : client = InferenceClient ( provider = \"hf-inference\" , api_key = self . _api_key ) # output is a PIL.Image object try : image = client . text_to_image ( prompt , model = model . model_internal_name (), ) except : logging . error ( \"API call failed\" , exc_info = True ) raise return ImageMedia ( image , { 'Software' : f \" { self . platform_name () } / { model . model_name () } \" }) def _image2image ( self , model : Model , prompt : str , image : Image . Image , ** kwargs : Any ) -> Image . Image : \"\"\"Not supported\"\"\" pass","title":"HuggingFacePlatform"},{"location":"api/#polymage.platform.lmstudio","text":"","title":"lmstudio"},{"location":"api/#polymage.platform.lmstudio.LMStudioPlatform","text":"Bases: Platform Source code in src/polymage/platform/lmstudio.py 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 class LMStudioPlatform ( Platform ): def __init__ ( self , host : str = \"127.0.0.1:1234\" , ** kwargs : Any ) -> None : super () . __init__ ( 'lmstudio' , list (( gemma_3_27b , qwen3_vl_30b )), ** kwargs ) self . _host = host self . _api_key = \"lm-studio\" # Dummy key (LM Studio doesn't require real keys) def _text2text ( self , model : Model , prompt : str , media : Optional [ List [ Media ]] = None , response_model : Optional [ BaseModel ] = None , ** kwargs : Any ) -> str : system_prompt : Optional [ str ] = kwargs . get ( \"system_prompt\" , \"\" ) client = OpenAI ( base_url = f \"http:// { self . _host } /v1\" , # LM Studio's default endpoint api_key = self . _api_key ) response = client . chat . completions . create ( model = model . model_internal_name (), messages = [ { \"role\" : \"system\" , \"content\" : system_prompt }, { \"role\" : \"user\" , \"content\" : prompt } ], temperature = 0.8 ) return response . choices [ 0 ] . message . content . strip () # # using structured data may sometime fail, because the result is not a valid JSON # if the JSON is not valid, retry 3 times # @retry ( retry = retry_if_exception_type ( json . JSONDecodeError ), stop = stop_after_attempt ( 3 )) def _text2data ( self , model : Model , prompt : str , response_model : BaseModel , media : Optional [ List [ Media ]] = None , ** kwargs : Any ) -> str : system_prompt : Optional [ str ] = kwargs . get ( \"system_prompt\" , \"\" ) client = OpenAI ( base_url = f \"http:// { self . _host } /v1\" , # LM Studio's default endpoint api_key = self . _api_key ) json_schema = response_model . model_json_schema () json_schema_name = json_schema [ 'title' ] chat_completion = client . chat . completions . create ( model = model . model_internal_name (), messages = [ { \"role\" : \"system\" , \"content\" : system_prompt }, { \"role\" : \"user\" , \"content\" : prompt } ], response_format = { \"type\" : \"json_schema\" , \"json_schema\" : { \"name\" : json_schema_name , \"schema\" : json_schema , }, }, temperature = 0.8 , ) json_string = chat_completion . choices [ 0 ] . message . content . strip () # return a python Dict return json . loads ( json_string ) def _image2text ( self , model : Model , prompt : str , media : List [ ImageMedia ], ** kwargs : Any ) -> str : client = OpenAI ( base_url = \"http://localhost:1234/v1\" , # LM Studio's default endpoint api_key = \"lm-studio\" # Dummy key (LM Studio doesn't require real keys) ) if len ( media ) == 0 : return \"\" else : image = media [ 0 ] base64_image = image . to_base64 () response = client . responses . create ( model = model . model_internal_name (), input = [ { \"role\" : \"user\" , \"content\" : [ { \"type\" : \"input_text\" , \"text\" : prompt }, { \"type\" : \"input_image\" , \"image_url\" : f \"data:image/png;base64, { base64_image } \" }, ], } ], ) return response . output [ 0 ] . content [ 0 ] . text def _text2image ( self , model : str , prompt : str , ** kwargs : Any ) -> Image . Image : \"\"\"Not supported\"\"\" pass def _image2image ( self , model : str , prompt : str , image : Image . Image , ** kwargs : Any ) -> Image . Image : \"\"\"Not supported\"\"\" pass","title":"LMStudioPlatform"},{"location":"api/#polymage.platform.platform","text":"","title":"platform"},{"location":"api/#polymage.platform.platform.Platform","text":"Bases: ABC Source code in src/polymage/platform/platform.py 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 class Platform ( ABC ): def __init__ ( self , name : str , models : List [ Model ], ** kwargs : Any ) -> None : self . _name = name self . _models = models def platform_name ( self ) -> str : return self . _name def platform_models ( self ) -> List [ Model ]: return self . _models def getModelByName ( self , name : str ) -> Model : for m in self . platform_models (): if m . model_name () == name : return m raise ValueError ( f \"Model { name } not found\" ) def text2text ( self , model : str , prompt : str , media : Optional [ List [ Media ]] = None , response_model : Optional [ str ] = None , ** kwargs : Any ) -> Any : \"\"\" Convert text to text with optional structured output. Args: model: The model identifier to use prompt: The input text prompt media: Optional list of media objects response_model: Optional Pydantic model for structured output **kwargs: Additional platform-specific arguments Returns: Any: Text response or structured data \"\"\" # get the model object for this platform platform_model = self . getModelByName ( model ) if response_model is None : return self . _text2text ( platform_model , prompt , media = media , response_model = response_model , ** kwargs ) # structured data output else : return self . _text2data ( platform_model , prompt , media = media , response_model = response_model , ** kwargs ) @abstractmethod def _text2text ( self , model : Model , prompt : str , media : Optional [ List [ Media ]] = None , response_model : Optional [ BaseModel ] = None , ** kwargs : Any ) -> Any : \"\"\"Platform-specific execution interface for text-to-text conversion\"\"\" pass @abstractmethod def _text2data ( self , model : Model , prompt : str , response_model : str , media : Optional [ List [ Media ]] = None , ** kwargs : Any ) -> Dict [ str , Any ]: \"\"\"Platform-specific execution interface for text-to-structured data conversion\"\"\" pass def text2image ( self , model : str , prompt : str , ** kwargs : Any ) -> ImageMedia : \"\"\" Convert text to image. Args: model: The model identifier to use prompt: The input text prompt **kwargs: Additional platform-specific arguments Returns: ImageMedia: Generated image media object \"\"\" platform_model = self . getModelByName ( model ) return self . _text2image ( platform_model , prompt , ** kwargs ) @abstractmethod def _text2image ( self , model : Model , prompt : str , ** kwargs : Any ) -> ImageMedia : \"\"\"Platform-specific execution interface for text-to-image conversion\"\"\" pass def image2text ( self , model : str , prompt : str , media : List [ ImageMedia ], ** kwargs : Any ) -> str : \"\"\" Convert image to text. Args: model: The model identifier to use prompt: The input text prompt guiding the image analysis media: List of ImageMedia objects to process **kwargs: Additional platform-specific arguments Returns: str: Text description or caption of the image(s) Raises: ValueError: If media list is empty \"\"\" platform_model = self . getModelByName ( model ) if not media : raise ValueError ( \"Media list cannot be empty\" ) return self . _image2text ( platform_model , prompt , media = media , ** kwargs ) @abstractmethod def _image2text ( self , model : Model , prompt : str , media : List [ ImageMedia ], ** kwargs : Any ) -> str : \"\"\"Platform-specific execution interface for image-to-text conversion\"\"\" pass def image2image ( self , model : str , prompt : str , media : List [ ImageMedia ], ** kwargs : Any ) -> ImageMedia : \"\"\" Convert image to image (image editing/transformations). Args: model: The model identifier to use prompt: The input text prompt guiding the transformation media: List of ImageMedia objects to process **kwargs: Additional platform-specific arguments Returns: ImageMedia: Transformed image media object \"\"\" platform_model = self . getModelByName ( model ) if media is not None : image = media [ 0 ] return self . _image2image ( platform_model , prompt , media = image , ** kwargs ) @abstractmethod def _image2image ( self , model : Model , prompt : str , media : ImageMedia , ** kwargs : Any ) -> ImageMedia : \"\"\"Platform-specific execution interface for image-to-image conversion\"\"\" pass image2image ( model , prompt , media , ** kwargs ) Convert image to image (image editing/transformations). Parameters: model ( str ) \u2013 The model identifier to use prompt ( str ) \u2013 The input text prompt guiding the transformation media ( List [ ImageMedia ] ) \u2013 List of ImageMedia objects to process **kwargs ( Any , default: {} ) \u2013 Additional platform-specific arguments Returns: ImageMedia ( ImageMedia ) \u2013 Transformed image media object Source code in src/polymage/platform/platform.py 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 def image2image ( self , model : str , prompt : str , media : List [ ImageMedia ], ** kwargs : Any ) -> ImageMedia : \"\"\" Convert image to image (image editing/transformations). Args: model: The model identifier to use prompt: The input text prompt guiding the transformation media: List of ImageMedia objects to process **kwargs: Additional platform-specific arguments Returns: ImageMedia: Transformed image media object \"\"\" platform_model = self . getModelByName ( model ) if media is not None : image = media [ 0 ] return self . _image2image ( platform_model , prompt , media = image , ** kwargs ) image2text ( model , prompt , media , ** kwargs ) Convert image to text. Parameters: model ( str ) \u2013 The model identifier to use prompt ( str ) \u2013 The input text prompt guiding the image analysis media ( List [ ImageMedia ] ) \u2013 List of ImageMedia objects to process **kwargs ( Any , default: {} ) \u2013 Additional platform-specific arguments Returns: str ( str ) \u2013 Text description or caption of the image(s) Raises: ValueError \u2013 If media list is empty Source code in src/polymage/platform/platform.py 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 def image2text ( self , model : str , prompt : str , media : List [ ImageMedia ], ** kwargs : Any ) -> str : \"\"\" Convert image to text. Args: model: The model identifier to use prompt: The input text prompt guiding the image analysis media: List of ImageMedia objects to process **kwargs: Additional platform-specific arguments Returns: str: Text description or caption of the image(s) Raises: ValueError: If media list is empty \"\"\" platform_model = self . getModelByName ( model ) if not media : raise ValueError ( \"Media list cannot be empty\" ) return self . _image2text ( platform_model , prompt , media = media , ** kwargs ) text2image ( model , prompt , ** kwargs ) Convert text to image. Parameters: model ( str ) \u2013 The model identifier to use prompt ( str ) \u2013 The input text prompt **kwargs ( Any , default: {} ) \u2013 Additional platform-specific arguments Returns: ImageMedia ( ImageMedia ) \u2013 Generated image media object Source code in src/polymage/platform/platform.py 69 70 71 72 73 74 75 76 77 78 79 80 81 82 def text2image ( self , model : str , prompt : str , ** kwargs : Any ) -> ImageMedia : \"\"\" Convert text to image. Args: model: The model identifier to use prompt: The input text prompt **kwargs: Additional platform-specific arguments Returns: ImageMedia: Generated image media object \"\"\" platform_model = self . getModelByName ( model ) return self . _text2image ( platform_model , prompt , ** kwargs ) text2text ( model , prompt , media = None , response_model = None , ** kwargs ) Convert text to text with optional structured output. Parameters: model ( str ) \u2013 The model identifier to use prompt ( str ) \u2013 The input text prompt media ( Optional [ List [ Media ]] , default: None ) \u2013 Optional list of media objects response_model ( Optional [ str ] , default: None ) \u2013 Optional Pydantic model for structured output **kwargs ( Any , default: {} ) \u2013 Additional platform-specific arguments Returns: Any ( Any ) \u2013 Text response or structured data Source code in src/polymage/platform/platform.py 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 def text2text ( self , model : str , prompt : str , media : Optional [ List [ Media ]] = None , response_model : Optional [ str ] = None , ** kwargs : Any ) -> Any : \"\"\" Convert text to text with optional structured output. Args: model: The model identifier to use prompt: The input text prompt media: Optional list of media objects response_model: Optional Pydantic model for structured output **kwargs: Additional platform-specific arguments Returns: Any: Text response or structured data \"\"\" # get the model object for this platform platform_model = self . getModelByName ( model ) if response_model is None : return self . _text2text ( platform_model , prompt , media = media , response_model = response_model , ** kwargs ) # structured data output else : return self . _text2data ( platform_model , prompt , media = media , response_model = response_model , ** kwargs )","title":"Platform"}]}